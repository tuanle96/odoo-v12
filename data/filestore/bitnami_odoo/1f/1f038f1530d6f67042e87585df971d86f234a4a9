
/* /web/static/src/js/services/session.js defined in bundle 'web.assets_frontend' */
odoo.define('web.session',function(require){"use strict";var Session=require('web.Session');var modules=odoo._modules;var session=new Session(undefined,undefined,{modules:modules,use_cors:false});session.is_bound=session.session_bind();return session;});;

/* /web/static/src/js/chrome/public_root_widget.js defined in bundle 'web.assets_frontend' */
odoo.define('root.widget',function(require){"use strict";var ServiceProviderMixin=require('web.ServiceProviderMixin');var Widget=require('web.Widget');var PublicRootWidget=Widget.extend(ServiceProviderMixin,{init:function(){this._super.apply(this,arguments);ServiceProviderMixin.init.call(this);}});return new PublicRootWidget();});;

/* /web_editor/static/src/js/content/body_manager.js defined in bundle 'web.assets_frontend' */
odoo.define('web_editor.BodyManager',function(require){'use strict';var weContext=require('web_editor.context');var rootWidget=require('web_editor.root_widget');var ServiceProviderMixin=require('web.ServiceProviderMixin');var session=require('web.session');var BodyManager=rootWidget.RootWidget.extend(ServiceProviderMixin,{init:function(){this._super.apply(this,arguments);ServiceProviderMixin.init.call(this);},willStart:function(){return $.when(this._super.apply(this,arguments),session.is_bound);},_call_service:function(event){if(event.data.service==='ajax'&&event.data.method==='rpc'){var route=event.data.args[0];if(_.str.startsWith(route,'/web/dataset/call_kw/')){var params=event.data.args[1];var options=event.data.args[2];params.kwargs.context=_.extend({},weContext.get(),params.kwargs.context||{});if(options){params.kwargs.context=_.omit(params.kwargs.context,options.noContextKeys);event.data.args[2]=_.omit(options,'noContextKeys');}
params.kwargs.context=JSON.parse(JSON.stringify(params.kwargs.context));}}
return ServiceProviderMixin._call_service.apply(this,arguments);},});return BodyManager;});;

/* /web_editor/static/src/js/root_widget.js defined in bundle 'web.assets_frontend' */
odoo.define('web_editor.root_widget',function(require){'use strict';var Class=require('web.Class');var dom=require('web.dom');var mixins=require('web.mixins');var session=require('web.session');var Widget=require('web.Widget');var RootWidget=Widget.extend({custom_events:_.extend({},Widget.prototype.custom_events||{},{registry_update:'_onRegistryUpdate',get_session:'_onGetSession',}),init:function(){this._super.apply(this,arguments);this._widgets=[];this._listenToUpdates=false;this._getRegistry().setParent(this);},start:function(){var defs=[this._super.apply(this,arguments)];defs.push(this._attachComponents());this._listenToUpdates=true;return $.when.apply($,defs);},_attachComponent:function(childInfo,$from){var self=this;var $elements=dom.cssFind($from||this.$el,childInfo.selector);var defs=_.map($elements,function(element){var w=new childInfo.Widget(self);self._widgets.push(w);return w.attachTo(element);});return $.when.apply($,defs);},_attachComponents:function($from){var self=this;var childInfos=this._getRegistry().get();var defs=_.map(childInfos,function(childInfo){return self._attachComponent(childInfo,$from);});return $.when.apply($,defs);},_getRegistry:function(){},_onGetSession:function(event){if(event.data.callback){event.data.callback(session);}},_onRegistryUpdate:function(ev){ev.stopPropagation();if(this._listenToUpdates){this._attachComponent(ev.data);}},});var RootWidgetRegistry=Class.extend(mixins.EventDispatcherMixin,{init:function(){mixins.EventDispatcherMixin.init.call(this);this._registry=[];},add:function(Widget,selector){var registryInfo={Widget:Widget,selector:selector,};this._registry.push(registryInfo);this.trigger_up('registry_update',registryInfo);},get:function(){return this._registry;},});return{RootWidget:RootWidget,RootWidgetRegistry:RootWidgetRegistry,};});;

/* /portal/static/src/js/portal.js defined in bundle 'web.assets_frontend' */
odoo.define('portal.portal',function(require){'use strict';require('web.dom_ready');if(!$('.o_portal').length){return $.Deferred().reject("DOM doesn't contain '.o_portal'");}
if($('.o_portal_details').length){var state_options=$("select[name='state_id']:enabled option:not(:first)");$('.o_portal_details').on('change',"select[name='country_id']",function(){var select=$("select[name='state_id']");state_options.detach();var displayed_state=state_options.filter("[data-country_id="+($(this).val()||0)+"]");var nb=displayed_state.appendTo(select).show().size();select.parent().toggle(nb>=1);});$('.o_portal_details').find("select[name='country_id']").change();}
if($('.o_portal_search_panel').length){$('.o_portal_search_panel .search-submit').click(function(){var search=$.deparam(window.location.search.substring(1));search.search_in=$(".o_portal_search_panel .dropdown-item.active").attr("href").replace("#","");search.search=$(".o_portal_search_panel input[name='search']").val();window.location.search=$.param(search);});$('.o_portal_search_panel .dropdown-menu').find('.dropdown-item').click(function(e){e.preventDefault();$(this).parents('.dropdown-menu').find('.dropdown-item').removeClass('active');$(this).closest('.dropdown-item').addClass('active');var label=$(this).clone();label.find('span.nolabel').remove();$(".o_portal_search_panel span#search_label").text(label.text());});$('.o_portal_search_panel .dropdown-menu').find('.dropdown-item.active').trigger('click');$(".o_portal_search_panel input[name='search']").on('keyup',function(e){if(e.keyCode===13){$('.o_portal_search_panel .search-submit').trigger('click');}});}});;

/* /portal/static/src/js/portal_tour.js defined in bundle 'web.assets_frontend' */
odoo.define('portal.tour',function(require){'use strict';var tour=require("web_tour.tour");tour.register('portal_load_homepage',{test:true,url:'/my',},[{content:"Check portal is loaded",trigger:'a[href*="/my/account"]:contains("Edit"):first',},{content:"Load my account details",trigger:'input[value="Joel Willis"]'}]);});;

/* /portal/static/src/js/portal_chatter.js defined in bundle 'web.assets_frontend' */
odoo.define('portal.chatter',function(require){'use strict';var base=require('web_editor.base');var ajax=require('web.ajax');var core=require('web.core');var dom=require('web.dom');var Widget=require('web.Widget');var rpc=require('web.rpc');var time=require('web.time');var qweb=core.qweb;var _t=core._t;var PortalChatter=Widget.extend({template:'portal.chatter',events:{"click .o_portal_chatter_pager_btn":'_onClickPager','click .o_portal_chatter_composer_btn':'_onSubmitButtonClick',},init:function(parent,options){this._super.apply(this,arguments);this.options=_.defaults(options||{},{'allow_composer':true,'display_composer':false,'csrf_token':odoo.csrf_token,'message_count':0,'pager_step':10,'pager_scope':5,'pager_start':1,'is_user_public':true,'is_user_publisher':false,'domain':[],});this.set('messages',[]);this.set('message_count',this.options['message_count']);this.set('pager',{});this.set('domain',this.options['domain']);this._current_page=this.options['pager_start'];this._onSubmitButtonClick=dom.makeButtonHandler(this._onSubmitButtonClick);},willStart:function(){var self=this;return $.when(rpc.query({route:'/mail/chatter_init',params:this._messageFetchPrepareParams()}),this._loadTemplates()).then(function(result){self.result=result;self.options=_.extend(self.options,self.result['options']||{});return result;});},start:function(){this.on("change:messages",this,this._renderMessages);this.on("change:message_count",this,function(){this._renderMessageCount();this.set('pager',this._pager(this._current_page));});this.on("change:pager",this,this._renderPager);this.on("change:domain",this,this._onChangeDomain);this.set('message_count',this.options['message_count']);this.set('messages',this.preprocessMessages(this.result['messages']));return this._super.apply(this,arguments);},messageFetch:function(domain){var self=this;return rpc.query({route:'/mail/chatter_fetch',params:self._messageFetchPrepareParams()}).then(function(result){self.set('messages',self.preprocessMessages(result['messages']));self.set('message_count',result['message_count']);});},preprocessMessages:function(messages){_.each(messages,function(m){m['author_avatar_url']=_.str.sprintf('/web/image/%s/%s/author_avatar/50x50','mail.message',m.id);m['published_date_str']=_.str.sprintf(_t('Published on %s'),moment(time.str_to_datetime(m.date)).format('MMMM Do YYYY, h:mm:ss a'));});return messages;},_changeCurrentPage:function(page,domain){this._current_page=page;var d=domain?domain:_.clone(this.get('domain'));this.set('domain',d);},_loadTemplates:function(){return ajax.loadXML('/portal/static/src/xml/portal_chatter.xml',qweb);},_messageFetchPrepareParams:function(){var self=this;var data={'res_model':this.options['res_model'],'res_id':this.options['res_id'],'limit':this.options['pager_step'],'offset':(this._current_page-1)*this.options['pager_step'],'allow_composer':this.options['allow_composer'],};if(self.options['token']){data['token']=self.options['token'];}
if(this.get('domain')){data['domain']=this.get('domain');}
return data;},_pager:function(page){var page=page||1;var total=this.get('message_count');var scope=this.options['pager_scope'];var step=this.options['pager_step'];var page_count=Math.ceil(parseFloat(total)/step);var page=Math.max(1,Math.min(parseInt(page),page_count));scope-=1;var pmin=Math.max(page-parseInt(Math.floor(scope/2)),1);var pmax=Math.min(pmin+scope,page_count);if(pmax-scope>0){pmin=pmax-scope;}else{pmin=1;}
var pages=[];_.each(_.range(pmin,pmax+1),function(index){pages.push(index);});return{"page_count":page_count,"offset":(page-1)*step,"page":page,"page_start":pmin,"page_previous":Math.max(pmin,page-1),"page_next":Math.min(pmax,page+1),"page_end":pmax,"pages":pages};},_renderMessages:function(){this.$('.o_portal_chatter_messages').html(qweb.render("portal.chatter_messages",{widget:this}));},_renderMessageCount:function(){this.$('.o_message_counter').replaceWith(qweb.render("portal.chatter_message_count",{widget:this}));},_renderPager:function(){this.$('.o_portal_chatter_pager').replaceWith(qweb.render("portal.pager",{widget:this}));},_onChangeDomain:function(){var self=this;this.messageFetch().then(function(){var p=self._current_page;self.set('pager',self._pager(p));});},_onClickPager:function(ev){ev.preventDefault();var page=$(ev.currentTarget).data('page');this._changeCurrentPage(page);},_onSubmitButtonClick:function(){return $.Deferred();},});base.ready().then(function(){$('.o_portal_chatter').each(function(index){var $elem=$(this);var mail_thread=new PortalChatter(null,$elem.data());mail_thread.appendTo($elem);});});return{PortalChatter:PortalChatter,};});;

/* /portal/static/src/js/portal_signature.js defined in bundle 'web.assets_frontend' */
odoo.define('portal.signature_form',function(require){"use strict";require('web_editor.ready');var ajax=require('web.ajax');var base=require('web_editor.base');var core=require('web.core');var Widget=require("web.Widget");var rpc=require("web.rpc");var qweb=core.qweb;var SignatureForm=Widget.extend({template:'portal.portal_signature',events:{'click #o_portal_sign_clear':'clearSign','click .o_portal_sign_submit':'submitSign','init #o_portal_sign_accept':'initSign',},init:function(parent,options){this._super.apply(this,arguments);this.options=_.extend(options||{},{csrf_token:odoo.csrf_token,});},willStart:function(){return this._loadTemplates();},start:function(){this.initSign();},initSign:function(){this.$("#o_portal_signature").empty().jSignature({'decor-color':'#D1D0CE','color':'#000','background-color':'#fff','height':'142px','width':'100%',});this.empty_sign=this.$("#o_portal_signature").jSignature('getData','image');},clearSign:function(){this.$("#o_portal_signature").jSignature('reset');},submitSign:function(ev){ev.preventDefault();var self=this;var $confirm_btn=self.$el.find('button[type="submit"]');var partner_name=self.$("#o_portal_sign_name").val();var signature=self.$("#o_portal_signature").jSignature('getData','image');var is_empty=signature?this.empty_sign[1]===signature[1]:true;this.$('#o_portal_sign_name').parent().toggleClass('o_has_error',!partner_name).find('.form-control, .custom-select').toggleClass('is-invalid',!partner_name);this.$('#o_portal_sign_draw').toggleClass('bg-danger text-white',is_empty);if(is_empty||!partner_name){return false;}
$confirm_btn.prepend('<i class="fa fa-spinner fa-spin"></i> ');$confirm_btn.attr('disabled',true);return rpc.query({route:this.options.callUrl,params:{'res_id':this.options.resId,'access_token':this.options.accessToken,'partner_name':partner_name,'signature':signature?signature[1]:false,},}).then(function(data){self.$('.fa-spinner').remove();if(data.error){self.$('.o_portal_sign_error_msg').remove();$confirm_btn.before(qweb.render('portal.portal_signature_error',{message:data.error}));$confirm_btn.attr('disabled',false);}
else if(data.success){$confirm_btn.remove();var $success=qweb.render("portal.portal_signature_success",{widget:data});self.$('#o_portal_sign_draw').parent().replaceWith($success);}
if(data.force_refresh){if(data.redirect_url){window.location=data.redirect_url;}else{window.location.reload();}}});},_loadTemplates:function(){return ajax.loadXML('/portal/static/src/xml/portal_signature.xml',qweb);},});base.ready().then(function(){$('.o_portal_signature_form').each(function(){var hasBeenReset=false;var $elem=$(this);var form=new SignatureForm(null,$elem.data());form.appendTo($elem);$elem.parents('.modal').on('shown.bs.modal',function(ev){$elem.trigger('resize');if(!hasBeenReset){hasBeenReset=true;form.initSign();}});});});return{SignatureForm:SignatureForm,};});;

/* /portal/static/src/js/portal_sidebar.js defined in bundle 'web.assets_frontend' */
odoo.define('portal.PortalSidebar',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Widget=require('web.Widget');var time=require('web.time');var _t=core._t;var PortalSidebar=Widget.extend({start:function(){var self=this;this._super.apply(this,arguments);this._setDelayLabel();},_setDelayLabel:function(){var $sidebarTimeago=this.$el.find('.o_portal_sidebar_timeago');_.each($sidebarTimeago,function(el){var dateTime=moment(time.auto_str_to_date($(el).attr('datetime'))),today=moment().startOf('day'),diff=dateTime.diff(today,'days',true),displayStr;if(diff===0){displayStr=_t('Due today');}else if(diff>0){displayStr=_.str.sprintf(_t('Due in %d days'),Math.abs(diff));}else{displayStr=_.str.sprintf(_t('%d days overdue'),Math.abs(diff));}
$(el).text(displayStr);});},_printIframeContent:function(href){if($.browser.mozilla){window.open(href,'_blank');return;}
if(!this.printContent){this.printContent=$('<iframe id="print_iframe_content" src="'+href+'" style="display:none"></iframe>');this.$el.append(this.printContent);this.printContent.on('load',function(){$(this).get(0).contentWindow.print();});}else{this.printContent.get(0).contentWindow.print();}},});return PortalSidebar;});;

/* /auth_signup/static/src/js/signup.js defined in bundle 'web.assets_frontend' */
odoo.define('auth_signup.signup',function(require){'use strict';var base=require('web_editor.base');base.ready().then(function(){if($('.oe_signup_form').length>0){$('.oe_signup_form').on('submit',function(ev){var $form=$(ev.currentTarget);var $btn=$form.find('.oe_login_buttons > button[type="submit"]');$btn.attr('disabled','disabled');$btn.prepend('<i class="fa fa-refresh fa-spin"/> ');});}});});;

/* /account/static/src/js/account_portal_sidebar.js defined in bundle 'web.assets_frontend' */
odoo.define('account.AccountPortalSidebar.instance',function(require){"use strict";require('web.dom_ready');var AccountPortalSidebar=require('account.AccountPortalSidebar');if(!$('.o_portal_invoice_sidebar').length){return $.Deferred().reject("DOM doesn't contain '.o_portal_invoice_sidebar'");}
var account_portal_sidebar=new AccountPortalSidebar();return account_portal_sidebar.attachTo($('.o_portal_invoice_sidebar')).then(function(){return account_portal_sidebar;});});odoo.define('account.AccountPortalSidebar',function(require){"use strict";var PortalSidebar=require('portal.PortalSidebar');var AccountPortalSidebar=PortalSidebar.extend({events:{'click .o_portal_invoice_print':'_onPrintInvoice',},start:function(){var self=this;this._super.apply(this,arguments);var $invoiceHtml=this.$el.find('iframe#invoice_html');var updateIframeSize=self._updateIframeSize.bind(self,$invoiceHtml);$invoiceHtml.on('load',updateIframeSize);$(window).on('resize',updateIframeSize);},_updateIframeSize:function($el){var $wrapwrap=$el.contents().find('div#wrapwrap');$el.height(0);$el.height($wrapwrap[0].scrollHeight);},_onPrintInvoice:function(ev){ev.preventDefault();var href=$(ev.currentTarget).attr('href');this._printIframeContent(href);},});return AccountPortalSidebar;});;

/* /payment/static/lib/jquery.payment/jquery.payment.js defined in bundle 'web.assets_frontend' */
(function(){var $,cardFromNumber,cardFromType,cards,defaultFormat,formatBackCardNumber,formatBackExpiry,formatCardNumber,formatExpiry,formatForwardExpiry,formatForwardSlash,hasTextSelected,luhnCheck,reFormatCardNumber,restrictCVC,restrictCardNumber,restrictExpiry,restrictNumeric,setCardType,__slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i;}return-1;},_this=this;$=jQuery;$.payment={};$.payment.fn={};$.fn.payment=function(){var args,method;method=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];return $.payment.fn[method].apply(this,args);};defaultFormat=/(\d{1,4})/g;cards=[{type:'maestro',pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:defaultFormat,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:true},{type:'dinersclub',pattern:/^(36|38|30[0-5])/,format:defaultFormat,length:[14],cvcLength:[3],luhn:true},{type:'laser',pattern:/^(6706|6771|6709)/,format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:true},{type:'jcb',pattern:/^35/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:'unionpay',pattern:/^62/,format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:false},{type:'discover',pattern:/^(6011|65|64[4-9]|622)/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:'mastercard',pattern:/^5[1-5]/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:'amex',pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:true},{type:'visa',pattern:/^4/,format:defaultFormat,length:[13,14,15,16],cvcLength:[3],luhn:true}];cardFromNumber=function(num){var card,_i,_len;num=(num+'').replace(/\D/g,'');for(_i=0,_len=cards.length;_i<_len;_i++){card=cards[_i];if(card.pattern.test(num)){return card;}}};cardFromType=function(type){var card,_i,_len;for(_i=0,_len=cards.length;_i<_len;_i++){card=cards[_i];if(card.type===type){return card;}}};luhnCheck=function(num){var digit,digits,odd,sum,_i,_len;odd=true;sum=0;digits=(num+'').split('').reverse();for(_i=0,_len=digits.length;_i<_len;_i++){digit=digits[_i];digit=parseInt(digit,10);if((odd=!odd)){digit*=2;}
if(digit>9){digit-=9;}
sum+=digit;}
return sum%10===0;};hasTextSelected=function($target){var _ref;if(($target.prop('selectionStart')!=null)&&$target.prop('selectionStart')!==$target.prop('selectionEnd')){return true;}
if(typeof document!=="undefined"&&document!==null?(_ref=document.selection)!=null?typeof _ref.createRange==="function"?_ref.createRange().text:void 0:void 0:void 0){return true;}
return false;};reFormatCardNumber=function(e){var _this=this;return setTimeout(function(){var $target,value;$target=$(e.currentTarget);value=$target.val();value=$.payment.formatCardNumber(value);return $target.val(value);});};formatCardNumber=function(e){var $target,card,digit,length,re,upperLength,value;digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
$target=$(e.currentTarget);value=$target.val();card=cardFromNumber(value+digit);length=(value.replace(/\D/g,'')+digit).length;upperLength=16;if(card){upperLength=card.length[card.length.length-1];}
if(length>=upperLength){return;}
if(($target.prop('selectionStart')!=null)&&$target.prop('selectionStart')!==value.length){return;}
if(card&&card.type==='amex'){re=/^(\d{4}|\d{4}\s\d{6})$/;}else{re=/(?:^|\s)(\d{4})$/;}
if(re.test(value)){e.preventDefault();return $target.val(value+' '+digit);}else if(re.test(value+digit)){e.preventDefault();return $target.val(value+digit+' ');}};formatBackCardNumber=function(e){var $target,value;$target=$(e.currentTarget);value=$target.val();if(e.meta){return;}
if(e.which!==8){return;}
if(($target.prop('selectionStart')!=null)&&$target.prop('selectionStart')!==value.length){return;}
if(/\d\s$/.test(value)){e.preventDefault();return $target.val(value.replace(/\d\s$/,''));}else if(/\s\d?$/.test(value)){e.preventDefault();return $target.val(value.replace(/\s\d?$/,''));}};formatExpiry=function(e){var $target,digit,val;digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
$target=$(e.currentTarget);val=$target.val()+digit;if(/^\d$/.test(val)&&(val!=='0'&&val!=='1')){e.preventDefault();return $target.val("0"+val+" / ");}else if(/^\d\d$/.test(val)){e.preventDefault();return $target.val(""+val+" / ");}};formatForwardExpiry=function(e){var $target,digit,val;digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
$target=$(e.currentTarget);val=$target.val();if(/^\d\d$/.test(val)){return $target.val(""+val+" / ");}};formatForwardSlash=function(e){var $target,slash,val;slash=String.fromCharCode(e.which);if(slash!=='/'){return;}
$target=$(e.currentTarget);val=$target.val();if(/^\d$/.test(val)&&val!=='0'){return $target.val("0"+val+" / ");}};formatBackExpiry=function(e){var $target,value;if(e.meta){return;}
$target=$(e.currentTarget);value=$target.val();if(e.which!==8){return;}
if(($target.prop('selectionStart')!=null)&&$target.prop('selectionStart')!==value.length){return;}
if(/\d(\s|\/)+$/.test(value)){e.preventDefault();return $target.val(value.replace(/\d(\s|\/)*$/,''));}else if(/\s\/\s?\d?$/.test(value)){e.preventDefault();return $target.val(value.replace(/\s\/\s?\d?$/,''));}};restrictNumeric=function(e){var input;if(e.metaKey||e.ctrlKey){return true;}
if(e.which===32){return false;}
if(e.which===0){return true;}
if(e.which<33){return true;}
input=String.fromCharCode(e.which);return!!/[\d\s]/.test(input);};restrictCardNumber=function(e){var $target,card,digit,value;$target=$(e.currentTarget);digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
if(hasTextSelected($target)){return;}
value=($target.val()+digit).replace(/\D/g,'');card=cardFromNumber(value);if(card){return value.length<=card.length[card.length.length-1];}else{return value.length<=16;}};restrictExpiry=function(e){var $target,digit,value;$target=$(e.currentTarget);digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
if(hasTextSelected($target)){return;}
value=$target.val()+digit;value=value.replace(/\D/g,'');if(value.length>6){return false;}};restrictCVC=function(e){var $target,digit,val;$target=$(e.currentTarget);digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
val=$target.val()+digit;return val.length<=4;};setCardType=function(e){var $target,allTypes,card,cardType,val;$target=$(e.currentTarget);val=$target.val();cardType=$.payment.cardType(val)||'unknown';if(!$target.hasClass(cardType)){allTypes=(function(){var _i,_len,_results;_results=[];for(_i=0,_len=cards.length;_i<_len;_i++){card=cards[_i];_results.push(card.type);}
return _results;})();$target.removeClass('unknown');$target.removeClass(allTypes.join(' '));$target.addClass(cardType);$target.toggleClass('identified',cardType!=='unknown');return $target.trigger('payment.cardType',cardType);}};$.payment.fn.formatCardCVC=function(){this.payment('restrictNumeric');this.on('keypress',restrictCVC);return this;};$.payment.fn.formatCardExpiry=function(){this.payment('restrictNumeric');this.on('keypress',restrictExpiry);this.on('keypress',formatExpiry);this.on('keypress',formatForwardSlash);this.on('keypress',formatForwardExpiry);this.on('keydown',formatBackExpiry);return this;};$.payment.fn.formatCardNumber=function(){this.payment('restrictNumeric');this.on('keypress',restrictCardNumber);this.on('keypress',formatCardNumber);this.on('keydown',formatBackCardNumber);this.on('keyup',setCardType);this.on('paste',reFormatCardNumber);return this;};$.payment.fn.restrictNumeric=function(){this.on('keypress',restrictNumeric);return this;};$.payment.fn.cardExpiryVal=function(){return $.payment.cardExpiryVal($(this).val());};$.payment.cardExpiryVal=function(value){var month,prefix,year,_ref;value=value.replace(/\s/g,'');_ref=value.split('/',2),month=_ref[0],year=_ref[1];if((year!=null?year.length:void 0)===2&&/^\d+$/.test(year)){prefix=(new Date).getFullYear();prefix=prefix.toString().slice(0,2);year=prefix+year;}
month=parseInt(month,10);year=parseInt(year,10);return{month:month,year:year};};$.payment.validateCardNumber=function(num){var card,_ref;num=(num+'').replace(/\s+|-/g,'');if(!/^\d+$/.test(num)){return false;}
card=cardFromNumber(num);if(!card){return false;}
return(_ref=num.length,__indexOf.call(card.length,_ref)>=0)&&(card.luhn===false||luhnCheck(num));};$.payment.validateCardExpiry=function(month,year){var currentTime,expiry,prefix,_ref;if(typeof month==='object'&&'month'in month){_ref=month,month=_ref.month,year=_ref.year;}
if(!(month&&year)){return false;}
month=$.trim(month);year=$.trim(year);if(!/^\d+$/.test(month)){return false;}
if(!/^\d+$/.test(year)){return false;}
if(!(parseInt(month,10)<=12)){return false;}
if(year.length===2){prefix=(new Date).getFullYear();prefix=prefix.toString().slice(0,2);year=prefix+year;}
expiry=new Date(year,month);currentTime=new Date;expiry.setMonth(expiry.getMonth()-1);expiry.setMonth(expiry.getMonth()+1,1);return expiry>currentTime;};$.payment.validateCardCVC=function(cvc,type){var _ref,_ref1;cvc=$.trim(cvc);if(!/^\d+$/.test(cvc)){return false;}
if(type){return _ref=cvc.length,__indexOf.call((_ref1=cardFromType(type))!=null?_ref1.cvcLength:void 0,_ref)>=0;}else{return cvc.length>=3&&cvc.length<=4;}};$.payment.cardType=function(num){var _ref;if(!num){return null;}
return((_ref=cardFromNumber(num))!=null?_ref.type:void 0)||null;};$.payment.formatCardNumber=function(num){var card,groups,upperLength,_ref;card=cardFromNumber(num);if(!card){return num;}
upperLength=card.length[card.length.length-1];num=num.replace(/\D/g,'');num=num.slice(0,+upperLength+1||9e9);if(card.format.global){return(_ref=num.match(card.format))!=null?_ref.join(' '):void 0;}else{groups=card.format.exec(num);if(groups!=null){groups.shift();}
return groups!=null?groups.join(' '):void 0;}};}).call(this);;

/* /payment/static/src/js/payment_portal.js defined in bundle 'web.assets_frontend' */
$(document).ready(function(){$('input#cc_number').payment('formatCardNumber');$('input#cc_cvc').payment('formatCardCVC');$('input#cc_expiry').payment('formatCardExpiry')
$('input#cc_number').on('focusout',function(e){var valid_value=$.payment.validateCardNumber(this.value);var card_type=$.payment.cardType(this.value);if(card_type){$(this).parent('.form-group').children('.card_placeholder').removeClass().addClass('card_placeholder '+card_type);$(this).parent('.form-group').children('input[name="cc_brand"]').val(card_type)}
else{$(this).parent('.form-group').children('.card_placeholder').removeClass().addClass('card_placeholder');}
if(valid_value){$(this).parent('.form-group').addClass('o_has_success').find('.form-control, .custom-select').addClass('is-valid');$(this).parent('.form-group').removeClass('o_has_error').find('.form-control, .custom-select').removeClass('is-invalid');$(this).siblings('.o_invalid_field').remove();}
else{$(this).parent('.form-group').addClass('o_has_error').find('.form-control, .custom-select').addClass('is-invalid');$(this).parent('.form-group').removeClass('o_has_success').find('.form-control, .custom-select').removeClass('is-valid');}});$('input#cc_cvc').on('focusout',function(e){var cc_nbr=$(this).parents('.oe_cc').find('#cc_number').val();var card_type=$.payment.cardType(cc_nbr);var valid_value=$.payment.validateCardCVC(this.value,card_type);if(valid_value){$(this).parent('.form-group').addClass('o_has_success').find('.form-control, .custom-select').addClass('is-valid');$(this).parent('.form-group').removeClass('o_has_error').find('.form-control, .custom-select').removeClass('is-invalid');$(this).siblings('.o_invalid_field').remove();}
else{$(this).parent('.form-group').addClass('o_has_error').find('.form-control, .custom-select').addClass('is-invalid');$(this).parent('.form-group').removeClass('o_has_success').find('.form-control, .custom-select').removeClass('is-valid');}});$('input#cc_expiry').on('focusout',function(e){var expiry_value=$.payment.cardExpiryVal(this.value);var month=expiry_value.month||'';var year=expiry_value.year||'';var valid_value=$.payment.validateCardExpiry(month,year);if(valid_value){$(this).parent('.form-group').addClass('o_has_success').find('.form-control, .custom-select').addClass('is-valid');$(this).parent('.form-group').removeClass('o_has_error').find('.form-control, .custom-select').removeClass('is-invalid');$(this).siblings('.o_invalid_field').remove();}
else{$(this).parent('.form-group').addClass('o_has_error').find('.form-control, .custom-select').addClass('is-invalid');$(this).parent('.form-group').removeClass('o_has_success').find('.form-control, .custom-select').removeClass('is-valid');}});$('select[name="pm_acquirer_id"]').on('change',function(){var acquirer_id=$(this).val();$('.acquirer').addClass('d-none');$('.acquirer[data-acquirer-id="'+acquirer_id+'"]').removeClass('d-none');});});;

/* /payment/static/src/js/payment_transaction_portal.js defined in bundle 'web.assets_frontend' */
;

/* /payment/static/src/js/payment_form.js defined in bundle 'web.assets_frontend' */
odoo.define('payment.payment_form',function(require){"use strict";var ajax=require('web.ajax');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var Dialog=require("web.Dialog");var Widget=require("web.Widget");var rpc=require("web.rpc");var _t=core._t;var PaymentForm=Widget.extend({events:{'click #o_payment_form_pay':'payEvent','click #o_payment_form_add_pm':'addPmEvent','click button[name="delete_pm"]':'deletePmEvent','click input[type="radio"]':'radioClickEvent','click .o_payment_form_pay_icon_more':'onClickMorePaymentIcon',},init:function(parent,options){this._super.apply(this,arguments);this.options=_.extend(options||{},{});this.payEvent=dom.makeButtonHandler(this.payEvent);},start:function(){this.updateNewPaymentDisplayStatus();$('[data-toggle="tooltip"]').tooltip();},disableButton:function(button){$(button).attr('disabled',true);$(button).children('.fa-lock').removeClass('fa-lock');$(button).prepend('<span class="o_loader"><i class="fa fa-refresh fa-spin"></i>&nbsp;</span>');},enableButton:function(button){$(button).attr('disabled',false);$(button).children('.fa').addClass('fa-lock');$(button).find('span.o_loader').remove();},payEvent:function(ev){ev.preventDefault();var form=this.el;var checked_radio=this.$('input[type="radio"]:checked');var self=this;var button=ev.target;if(checked_radio.length===1){checked_radio=checked_radio[0];var acquirer_id=this.getAcquirerIdFromRadio(checked_radio);var acquirer_form=false;if(this.isNewPaymentRadio(checked_radio)){acquirer_form=this.$('#o_payment_add_token_acq_'+acquirer_id);}else{acquirer_form=this.$('#o_payment_form_acq_'+acquirer_id);}
var inputs_form=$('input',acquirer_form);var ds=$('input[name="data_set"]',acquirer_form)[0];if(this.isNewPaymentRadio(checked_radio)){if(this.options.partnerId===undefined){console.warn('payment_form: unset partner_id when adding new token; things could go wrong');}
var form_data=this.getFormData(inputs_form);var wrong_input=false;inputs_form.toArray().forEach(function(element){if($(element).attr('type')=='hidden'){return true;}
$(element).closest('div.form-group').removeClass('o_has_error').find('.form-control, .custom-select').removeClass('is-invalid');$(element).siblings(".o_invalid_field").remove();$(element).trigger("focusout");if(element.dataset.isRequired&&element.value.length===0){$(element).closest('div.form-group').addClass('o_has_error').find('.form-control, .custom-select').addClass('is-invalid');$(element).closest('div.form-group').append('<div style="color: red" class="o_invalid_field" aria-invalid="true">'+_.str.escapeHTML("The value is invalid.")+'</div>');wrong_input=true;}
else if($(element).closest('div.form-group').hasClass('o_has_error')){wrong_input=true;$(element).closest('div.form-group').append('<div style="color: red" class="o_invalid_field" aria-invalid="true">'+_.str.escapeHTML("The value is invalid.")+'</div>');}});if(wrong_input){return;}
this.disableButton(button);var verify_validity=this.$el.find('input[name="verify_validity"]');if(verify_validity.length>0){form_data.verify_validity=verify_validity[0].value==="1";}
return ajax.jsonRpc(ds.dataset.createRoute,'call',form_data).then(function(data){if(data.result){if(data['3d_secure']!==false){$("body").html(data['3d_secure']);}
else{checked_radio.value=data.id;form.submit();return $.Deferred();}}
else{if(data.error){self.displayError('',data.error);}else{self.displayError(_t('Server Error'),_t('e.g. Your credit card details are wrong. Please verify.'));}}
self.enableButton(button);}).fail(function(error,event){self.enableButton(button);self.displayError(_t('Server Error'),_t("We are not able to add your payment method at the moment.")+
error.data.message);});}
else if(this.isFormPaymentRadio(checked_radio)){var $tx_url=this.$el.find('input[name="prepare_tx_url"]');if($tx_url.length===1){var form_save_token=acquirer_form.find('input[name="o_payment_form_save_token"]').prop('checked');return ajax.jsonRpc($tx_url[0].value,'call',{'acquirer_id':parseInt(acquirer_id),'save_token':form_save_token,'access_token':self.options.accessToken,'success_url':self.options.successUrl,'error_url':self.options.errorUrl,'callback_method':self.options.callbackMethod,'order_id':self.options.orderId,}).then(function(result){if(result){var newForm=document.createElement('form');newForm.setAttribute("method","post");newForm.setAttribute("provider",checked_radio.dataset.provider);newForm.hidden=true;newForm.innerHTML=result;var action_url=$(newForm).find('input[name="data_set"]').data('actionUrl');newForm.setAttribute("action",action_url);$(document.getElementsByTagName('body')[0]).append(newForm);$(newForm).find('input[data-remove-me]').remove();if(action_url){newForm.submit();return $.Deferred();}}
else{self.displayError(_t('Server Error'),_t("We are not able to redirect you to the payment form."));}}).fail(function(error,event){self.displayError(_t('Server Error'),_t("We are not able to redirect you to the payment form. ")+
error.data.message);});}
else{this.displayError(_t("Cannot set-up the payment"),_t("We're unable to process your payment."));}}
else{this.disableButton(button);form.submit();return $.Deferred();}}
else{this.displayError(_t('No payment method selected'),_t('Please select a payment method.'));}},addPmEvent:function(ev){ev.stopPropagation();ev.preventDefault();var checked_radio=this.$('input[type="radio"]:checked');var self=this;var button=ev.target;if(checked_radio.length===1&&this.isNewPaymentRadio(checked_radio[0])){checked_radio=checked_radio[0];var acquirer_id=this.getAcquirerIdFromRadio(checked_radio);var acquirer_form=this.$('#o_payment_add_token_acq_'+acquirer_id);var inputs_form=$('input',acquirer_form);var form_data=this.getFormData(inputs_form);var ds=$('input[name="data_set"]',acquirer_form)[0];var wrong_input=false;inputs_form.toArray().forEach(function(element){if($(element).attr('type')=='hidden'){return true;}
$(element).closest('div.form-group').removeClass('o_has_error').find('.form-control, .custom-select').removeClass('is-invalid');$(element).siblings(".o_invalid_field").remove();$(element).trigger("focusout");if(element.dataset.isRequired&&element.value.length===0){$(element).closest('div.form-group').addClass('o_has_error').find('.form-control, .custom-select').addClass('is-invalid');var message='<div style="color: red" class="o_invalid_field" aria-invalid="true">'+_.str.escapeHTML("The value is invalid.")+'</div>';$(element).closest('div.form-group').append(message);wrong_input=true;}
else if($(element).closest('div.form-group').hasClass('o_has_error')){wrong_input=true;var message='<div style="color: red" class="o_invalid_field" aria-invalid="true">'+_.str.escapeHTML("The value is invalid.")+'</div>';$(element).closest('div.form-group').append(message);}});if(wrong_input){return;}
$(button).attr('disabled',true);$(button).children('.fa-plus-circle').removeClass('fa-plus-circle')
$(button).prepend('<span class="o_loader"><i class="fa fa-refresh fa-spin"></i>&nbsp;</span>');form_data.verify_validity=true;ajax.jsonRpc(ds.dataset.createRoute,'call',form_data).then(function(data){if(data.result){if(data['3d_secure']!==false){$("body").html(data['3d_secure']);}
else{if(form_data.return_url){window.location=form_data.return_url;}
else{window.location.reload();}}}
else{if(data.error){self.displayError('',data.error);}else{self.displayError(_t('Server Error'),_t('e.g. Your credit card details are wrong. Please verify.'));}}
$(button).attr('disabled',false);$(button).children('.fa').addClass('fa-plus-circle')
$(button).find('span.o_loader').remove();}).fail(function(error,event){$(button).attr('disabled',false);$(button).children('.fa').addClass('fa-plus-circle')
$(button).find('span.o_loader').remove();self.displayError(_t('Server error'),_t("We are not able to add your payment method at the moment.</p>")+
error.data.message);});}
else{this.displayError(_t('No payment method selected'),_t('Please select the option to add a new payment method.'));}},deletePmEvent:function(ev){ev.stopPropagation();ev.preventDefault();var self=this;var pm_id=parseInt(ev.target.value);var tokenDelete=function(){rpc.query({model:'payment.token',method:'unlink',args:[pm_id],}).then(function(result){if(result===true){ev.target.closest('div').remove();}},function(){self.displayError(_t('Server Error'),_t("We are not able to delete your payment method at the moment."));});};rpc.query({model:'payment.token',method:'get_linked_records',args:[pm_id],}).then(function(result){if(result[pm_id].length>0){var content='';result[pm_id].forEach(function(sub){content+='<p><a href="'+sub.url+'" title="'+sub.description+'">'+sub.name+'</a><p/>';});content=$('<div>').html(_t('<p>This card is currently linked to the following records:<p/>')+content);new Dialog(self,{title:_t('Warning!'),size:'medium',$content:content,buttons:[{text:_t('Confirm Deletion'),classes:'btn-primary',close:true,click:tokenDelete},{text:_t('Cancel'),close:true}]}).open();}
else{tokenDelete();}},function(err,event){self.displayError(_t('Server Error'),_t("We are not able to delete your payment method at the moment.")+err.data.message);});},onClickMorePaymentIcon:function(ev){ev.preventDefault();var $listItems=$(ev.currentTarget).parents('ul').children('li');var $moreItem=$(ev.currentTarget).parents('li');$listItems.removeClass('d-none');$moreItem.addClass('d-none');},radioClickEvent:function(ev){this.updateNewPaymentDisplayStatus();},updateNewPaymentDisplayStatus:function()
{var checked_radio=this.$('input[type="radio"]:checked');this.$('[id*="o_payment_add_token_acq_"]').addClass('d-none');this.$('[id*="o_payment_form_acq_"]').addClass('d-none');if(checked_radio.length!==1){return;}
checked_radio=checked_radio[0];var acquirer_id=this.getAcquirerIdFromRadio(checked_radio);if(this.isNewPaymentRadio(checked_radio)){this.$('#o_payment_add_token_acq_'+acquirer_id).removeClass('d-none');}
else if(this.isFormPaymentRadio(checked_radio)){this.$('#o_payment_form_acq_'+acquirer_id).removeClass('d-none');}},isNewPaymentRadio:function(element){return $(element).data('s2s-payment')==='True';},isFormPaymentRadio:function(element){return $(element).data('form-payment')==='True';},getAcquirerIdFromRadio:function(element){return $(element).data('acquirer-id');},displayError:function(title,message){var $checkedRadio=this.$('input[type="radio"]:checked'),acquirerID=this.getAcquirerIdFromRadio($checkedRadio[0]);var $acquirerForm;if(this.isNewPaymentRadio($checkedRadio[0])){$acquirerForm=this.$('#o_payment_add_token_acq_'+acquirerID);}
else if(this.isFormPaymentRadio($checkedRadio[0])){$acquirerForm=this.$('#o_payment_form_acq_'+acquirerID);}
if($checkedRadio.length===0){return new Dialog(null,{title:_t('Error: ')+_.str.escapeHTML(title),size:'medium',$content:"<p>"+(_.str.escapeHTML(message)||"")+"</p>",buttons:[{text:_t('Ok'),close:true}]}).open();}else{this.$('#payment_error').remove();var messageResult='<div class="alert alert-danger mb4" id="payment_error">';if(title!=''){messageResult=messageResult+'<b>'+_.str.escapeHTML(title)+':</b></br>';}
messageResult=messageResult+_.str.escapeHTML(message)+'</div>';$acquirerForm.append(messageResult);}},getFormData:function($form){var unindexed_array=$form.serializeArray();var indexed_array={};$.map(unindexed_array,function(n,i){indexed_array[n.name]=n.value;});return indexed_array;},});$(function(){if(!$('.o_payment_form').length){console.log("DOM doesn't contain '.o_payment_form'");return;}
$('.o_payment_form').each(function(){var $elem=$(this);var form=new PaymentForm(null,$elem.data());form.attachTo($elem);});});return PaymentForm;});;

/* /payment/static/src/js/payment_processing.js defined in bundle 'web.assets_frontend' */
odoo.define('payment.processing',function(require){'use strict';var Widget=require('web.Widget');var Ajax=require('web.ajax');var Core=require('web.core');var Qweb=Core.qweb;var _t=Core._t;$.blockUI.defaults.css.border='0';$.blockUI.defaults.css["background-color"]='';$.blockUI.defaults.overlayCSS["opacity"]='0.9';return Widget.extend({_payment_tx_ids:null,_pollCount:0,events:{},xmlDependencies:['/payment/static/src/xml/payment_processing.xml'],init:function(parent,payment_tx_ids){this._super.apply(this,arguments);this._payment_tx_ids=payment_tx_ids;},start:function(){this.displayLoading();this.poll();return this._super.apply(this,arguments);},startPolling:function(){var timeout=3000;if(this._pollCount>=10&&this._pollCount<20){timeout=10000;}
else if(this._pollCount>=20){timeout=30000;}
setTimeout(this.poll.bind(this),timeout);this._pollCount++;},poll:function(){var self=this;Ajax.jsonRpc('/payment/process/poll','call',{}).then(function(data){if(data.success===true){self.processPolledData(data.transactions);}
else{switch(data.error){case"tx_process_retry":break;case"no_tx_found":self.displayContent("payment.no_tx_found",{});break;default:self.displayContent("payment.exception",{exception_msg:data.error});break;}}
self.startPolling();}).fail(function(e){self.displayContent("payment.rpc_error",{});self.startPolling();});},processPolledData:function(transactions){var render_values={'tx_draft':[],'tx_pending':[],'tx_authorized':[],'tx_done':[],'tx_cancel':[],'tx_error':[],};if(transactions.length>0&&transactions[0].acquirer_provider=='transfer'){window.location=transactions[0].return_url;return;}
transactions.forEach(function(tx){var key='tx_'+tx.state;if(key in render_values){render_values[key].push(tx);}});function countTxInState(states){var nbTx=0;for(var prop in render_values){if(states.indexOf(prop)>-1&&render_values.hasOwnProperty(prop)){nbTx+=render_values[prop].length;}}
return nbTx;}
if(countTxInState(['tx_done','tx_error'])===1){var tx=render_values['tx_done'][0]||render_values['tx_error'][0];if(tx){window.location=tx.return_url;return;}}
this.displayContent("payment.display_tx_list",render_values);},displayContent:function(xmlid,render_values){var html=Qweb.render(xmlid,render_values);$.unblockUI();this.$el.find('.o_payment_processing_content').html(html);},displayLoading:function(){var msg=_t("We are processing your payments, please wait ...");$.blockUI({'message':'<h2 class="text-white"><img src="/web/static/src/img/spin.png" class="fa-pulse"/>'+'    <br />'+msg+'</h2>'});},});});